-------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  PATH/Main regressions -- study sample, with LRS (instead of rLRS).log
  log type:  text
 opened on:  15 Jul 2016, 15:26:22

. *log using "Main regressions -- study sample, age 50-70 for females and 55-70 for males", replace
. *log using "Main regressions -- all cohorts (HRS0-3) together", replace
. 
. ************************************************************
. ************************************************************
. ************************************************************
. ************************************************************
. ************************************************************
. 
. 
. 
. 
. 
. 
. 
. 
. 
. ************************************************************
. ************************************************************
. ************************************************************
. ************************************************************
. ************************************************************
. * LOAD THE DATA AND DEFINE THE SAMPLE AND THE OPTIONS FOR THE ANALYSES
. ************************************************************
. 
. use dataset_master.dta, clear

. 
. ************************************************************
. ************************************************************
. 
. * Define relative LRS as our ReproSuccess variable (for the baseline analyses)
. gen ReproSuccess = relLRS
(1 missing value generated)

. 
. ************************************************************
. ************************************************************
. 
. * To keep only the genotyped individuals 
. * (For the analyses with the scores, only genotyped individuals are used by default;
. *  but for the analyses with the phenotypic variables, we can either use the sample of all individuals (the defau
> lt) 
. *  or only use the sample of genotyped individuals. For the latter, unstar the following line:
. *keep if hwe_eur_keep==1
. 
. 
. ************************************************************
. ************************************************************
. * For the robustness checks:
. 
. * 1. With LRS instead of rLRS as the ReproSuccess variable
. replace ReproSuccess = absLRS
(13,530 real changes made, 1 to missing)

. 
. * 2. With the PLINK2 scores (already outputted below -- no need to alter anything in the code)
. 
. * 3. With individuals who were 
. *       (i) 70 or less in 2008 (born >= 1938) at the time of the last genotyping wave (to see if selection on sur
> vival after 70 years old biases results)
. *       (ii) age_childrenMeas>=50 for females and >=55 for males
. /***
> keep if byear >=38  & byear <= 53 
> drop if (age_childrenMeas < 55) & sex == 0 
> drop if (age_childrenMeas < 50) & sex == 1
> ***/
. 
. * 4. With the study sample (the HRS1-3 cohorts) together with the HRS0 cohort (to run this, comment out the line 
> "keep if study_sample==1" below)
. 
. ************************************************************
. ************************************************************
. * Defining the sample for the analyses
. 
. * To use the study sample (this sample is used for the main analyses and combines the HRS1-3 cohorts):
. keep if study_sample==1
(3,298 observations deleted)

. 
. * To use only the HRS0 cohort:
. *keep if byear >=24  & byear <= 30
. 
. * To use only the HRS1 cohort:
. *keep if byear >=31  & byear <= 41
. 
. * To use only the HRS2 cohort:
. *keep if byear >=42  & byear <= 47 
. 
. * To use only the HRS3 cohort:
. *keep if byear >=48  & byear <= 53 
. * NOTE: there are no observations for pheno_TC for the males in the HRS3 cohort => set pheno_TC to 1 when we need
>  to run the other analyses for males in the HRS3 cohort
. *replace pheno_TC = 1
. 
. ************************************************************
. ************************************************************
. ************************************************************
. ************************************************************
. ************************************************************
. 
. 
. 
. 
. 
. 
. 
. ************************************************************
. ************************************************************
. ************************************************************
. ************************************************************
. ************************************************************
. * RUNNING THE MAIN REGRESSION ANALYSES (FOR TABLES 1 AND 2)
. ************************************************************
. 
. cap drop PGS

. gen PGS = .
(11,850 missing values generated)

. cap drop Pheno

. gen Pheno = .
(11,850 missing values generated)

. cap drop PhenoXgenotyped 

. gen PhenoXgenotyped = .
(11,850 missing values generated)

. 
. ************************************************************
. ************************************************************
. * REGRESSION ON THE PGS -- females only 
. 
. * Regress ReproSuccess on the LDpred PGS ("PGS"), on the PLINK PGS ("PGSraw"), and on the phenotypic variables:
. foreach var in  BMI EA3 GLU HGT SCZ2 TC AAM  {
  2.         qui replace PGS = PGSldp_`var'
  3.         qui reg ReproSuccess PGS i.byear pc*     i.hacohort  if sex == 1
  4.         est store `var'_ldp
  5.         qui replace PGS = PGSraw_`var'
  6.         qui reg ReproSuccess PGS        i.byear pc*     i.hacohort  if sex == 1
  7.         est store `var'_raw
  8.         qui replace Pheno = pheno_`var'
  9.         qui reg ReproSuccess Pheno i.byear                      i.hacohort    if sex == 1
 10.         est store `var'_pheno
 11. }

. * Estimate table for each trait separately:
. estimates table BMI_ldp EA3_ldp GLU_ldp HGT_ldp SCZ2_ldp TC_ldp  AAM_ldp, keep(PGS) b se t p stats(N)   

---------------------------------------------------------------------------------------------------------
    Variable |  BMI_ldp      EA3_ldp      GLU_ldp      HGT_ldp      SCZ2_ldp      TC_ldp      AAM_ldp    
-------------+-------------------------------------------------------------------------------------------
         PGS |  .01975181   -.08486434    .01933686    -.0301915    -.0007528   -.03621922    .04455966  
             |  .02650667    .02661023    .02627558    .03603281    .02801929    .02689202    .02695423  
             |       0.75        -3.19         0.74        -0.84        -0.03        -1.35         1.65  
             |     0.4562       0.0014       0.4618       0.4022       0.9786       0.1781       0.0984  
-------------+-------------------------------------------------------------------------------------------
           N |       3416         3416         3416         3416         3416         3416         3416  
---------------------------------------------------------------------------------------------------------
                                                                                         legend: b/se/t/p

. estimates table BMI_raw EA3_raw GLU_raw HGT_raw SCZ2_raw TC_raw  AAM_raw, keep(PGS) b se t p stats(N)

---------------------------------------------------------------------------------------------------------
    Variable |  BMI_raw      EA3_raw      GLU_raw      HGT_raw      SCZ2_raw      TC_raw      AAM_raw    
-------------+-------------------------------------------------------------------------------------------
         PGS |  .01233686   -.07511787   -.00901525   -.02941381   -.02022703   -.01160712    .05369226  
             |  .02709358    .02691071     .0268216    .03430139    .03193575    .02680303      .026646  
             |       0.46        -2.79        -0.34        -0.86        -0.63        -0.43         2.02  
             |     0.6489       0.0053       0.7368       0.3912       0.5265       0.6650       0.0440  
-------------+-------------------------------------------------------------------------------------------
           N |       3416         3416         3416         3416         3416         3416         3416  
---------------------------------------------------------------------------------------------------------
                                                                                         legend: b/se/t/p

. estimates table BMI_pheno EA3_pheno GLU_pheno  HGT_pheno SCZ2_pheno TC_pheno  AAM_pheno, keep(Pheno) b se t p sta
> ts(N)

---------------------------------------------------------------------------------------------------------
    Variable | BMI_pheno    EA3_pheno    GLU_pheno    HGT_pheno    SCZ2_pheno    TC_pheno    AAM_pheno   
-------------+-------------------------------------------------------------------------------------------
       Pheno |   .0217901   -.14415732    (omitted)   -.01660604    (omitted)    .00124974    (omitted)  
             |  .00342967    .00828003                 .00308837                 .06025723               
             |       6.35       -17.41                     -5.38                      0.02               
             |     0.0000       0.0000                    0.0000                    0.9835               
-------------+-------------------------------------------------------------------------------------------
           N |       6396         6403         6414         6411         6414         4152         6414  
---------------------------------------------------------------------------------------------------------
                                                                                         legend: b/se/t/p

. 
. ************************************************************
. ************************************************************
. * REGRESSION ON THE PGS -- males only (=> sex == 0) 
. 
. * Regress ReproSuccess on the LDpred PGS ("PGS"), on the PLINK PGS ("PGSraw"), and on the phenotypic variables:
. foreach var in    BMI EA3 GLU HGT SCZ2 TC {
  2.         qui replace PGS = PGSldp_`var'
  3.         qui reg ReproSuccess PGS i.byear pc*  i.hacohort    if sex == 0
  4.         est store `var'_ldp
  5.         qui replace PGS = PGSraw_`var'
  6.         qui reg ReproSuccess PGS        i.byear pc*  i.hacohort if sex == 0
  7.         est store `var'_raw
  8.         qui replace Pheno = pheno_`var'
  9.         qui reg ReproSuccess Pheno i.byear                      i.hacohort    if sex == 0
 10.         est store `var'_pheno
 11. }

. * Estimate table for each trait separately:
. estimates table BMI_ldp EA3_ldp GLU_ldp HGT_ldp SCZ2_ldp TC_ldp, keep(PGS) b se t p stats(N)    

--------------------------------------------------------------------------------------------
    Variable |  BMI_ldp      EA3_ldp      GLU_ldp      HGT_ldp      SCZ2_ldp      TC_ldp    
-------------+------------------------------------------------------------------------------
         PGS |  .03609502   -.07857484   -.02445081   -.00568276    .02793152   -.00866182  
             |  .03101368    .02992354    .03039474    .04242441    .03233292    .03142329  
             |       1.16        -2.63        -0.80        -0.13         0.86        -0.28  
             |     0.2446       0.0087       0.4212       0.8935       0.3877       0.7828  
-------------+------------------------------------------------------------------------------
           N |       2571         2571         2571         2571         2571         2571  
--------------------------------------------------------------------------------------------
                                                                            legend: b/se/t/p

. estimates table BMI_raw EA3_raw GLU_raw HGT_raw SCZ2_raw TC_raw, keep(PGS) b se t p stats(N)

--------------------------------------------------------------------------------------------
    Variable |  BMI_raw      EA3_raw      GLU_raw      HGT_raw      SCZ2_raw      TC_raw    
-------------+------------------------------------------------------------------------------
         PGS |  .04679455   -.07868992   -.02986802    .00672051    .02165971    .00114758  
             |   .0314253    .03077582    .03044852    .04036324    .03577913    .03118411  
             |       1.49        -2.56        -0.98         0.17         0.61         0.04  
             |     0.1366       0.0106       0.3267       0.8678       0.5450       0.9706  
-------------+------------------------------------------------------------------------------
           N |       2571         2571         2571         2571         2571         2571  
--------------------------------------------------------------------------------------------
                                                                            legend: b/se/t/p

. estimates table BMI_pheno EA3_pheno GLU_pheno HGT_pheno SCZ2_pheno TC_pheno, keep(Pheno) b se t p stats(N)

--------------------------------------------------------------------------------------------
    Variable | BMI_pheno    EA3_pheno    GLU_pheno    HGT_pheno    SCZ2_pheno    TC_pheno   
-------------+------------------------------------------------------------------------------
       Pheno |  .01529507   -.05631009    (omitted)    -.0015217    (omitted)   -.06352496  
             |  .00464626    .00761029                 .00317442                 .06981902  
             |       3.29        -7.40                     -0.48                     -0.91  
             |     0.0010       0.0000                    0.6317                    0.3630  
-------------+------------------------------------------------------------------------------
           N |       5431         5419         5435         5435         5435         3078  
--------------------------------------------------------------------------------------------
                                                                            legend: b/se/t/p

. 
. 
. cap log off
