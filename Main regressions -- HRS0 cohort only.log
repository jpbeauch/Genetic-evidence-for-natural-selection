-------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  PATH/Main regressions -- HRS0 cohort only.log
  log type:  text
 opened on:  15 Jul 2016, 15:18:22

. *log using "Main regressions -- HRS1 cohort only", replace
. *log using "Main regressions -- HRS2 cohort only", replace
. *log using "Main regressions -- HRS3 cohort only", replace
. *log using "Main regressions -- study sample, with LRS (instead of rLRS)", replace
. *log using "Main regressions -- study sample, age 50-70 for females and 55-70 for males", replace
. *log using "Main regressions -- all cohorts (HRS0-3) together", replace
. 
. ************************************************************
. ************************************************************
. ************************************************************
. ************************************************************
. ************************************************************
. 
. 
. 
. 
. 
. 
. 
. 
. 
. ************************************************************
. ************************************************************
. ************************************************************
. ************************************************************
. ************************************************************
. * LOAD THE DATA AND DEFINE THE SAMPLE AND THE OPTIONS FOR THE ANALYSES
. ************************************************************
. 
. use dataset_master.dta, clear

. 
. ************************************************************
. ************************************************************
. 
. * Define relative LRS as our ReproSuccess variable (for the baseline analyses)
. gen ReproSuccess = relLRS
(1 missing value generated)

. 
. ************************************************************
. ************************************************************
. 
. * To keep only the genotyped individuals 
. * (For the analyses with the scores, only genotyped individuals are used by default;
. *  but for the analyses with the phenotypic variables, we can either use the sample of all individuals (the defau
> lt) 
. *  or only use the sample of genotyped individuals. For the latter, unstar the following line:
. *keep if hwe_eur_keep==1
. 
. 
. ************************************************************
. ************************************************************
. * For the robustness checks:
. 
. * 1. With LRS instead of rLRS as the ReproSuccess variable
. *replace ReproSuccess = absLRS
. 
. * 2. With the PLINK2 scores (already outputted below -- no need to alter anything in the code)
. 
. * 3. With individuals who were 
. *       (i) 70 or less in 2008 (born >= 1938) at the time of the last genotyping wave (to see if selection on sur
> vival after 70 years old biases results)
. *       (ii) age_childrenMeas>=50 for females and >=55 for males
. /***
> keep if byear >=38  & byear <= 53 
> drop if (age_childrenMeas < 55) & sex == 0 
> drop if (age_childrenMeas < 50) & sex == 1
> ***/
. 
. * 4. With the study sample (the HRS1-3 cohorts) together with the HRS0 cohort (to run this, comment out the line 
> "keep if study_sample==1" below)
. 
. ************************************************************
. ************************************************************
. * Defining the sample for the analyses
. 
. * To use the study sample (this sample is used for the main analyses and combines the HRS1-3 cohorts):
. *keep if study_sample==1
. 
. * To use only the HRS0 cohort:
. keep if byear >=24  & byear <= 30
(11,850 observations deleted)

. 
. * To use only the HRS1 cohort:
. *keep if byear >=31  & byear <= 41
. 
. * To use only the HRS2 cohort:
. *keep if byear >=42  & byear <= 47 
. 
. * To use only the HRS3 cohort:
. *keep if byear >=48  & byear <= 53 
. * NOTE: there are no observations for pheno_TC for the males in the HRS3 cohort => set pheno_TC to 1 when we need
>  to run the other analyses for males in the HRS3 cohort
. *replace pheno_TC = 1
. 
. ************************************************************
. ************************************************************
. ************************************************************
. ************************************************************
. ************************************************************
. 
. 
. 
. 
. 
. 
. 
. ************************************************************
. ************************************************************
. ************************************************************
. ************************************************************
. ************************************************************
. * RUNNING THE MAIN REGRESSION ANALYSES (FOR TABLES 1 AND 2)
. ************************************************************
. 
. cap drop PGS

. gen PGS = .
(3,298 missing values generated)

. cap drop Pheno

. gen Pheno = .
(3,298 missing values generated)

. cap drop PhenoXgenotyped 

. gen PhenoXgenotyped = .
(3,298 missing values generated)

. 
. ************************************************************
. ************************************************************
. * REGRESSION ON THE PGS -- females only 
. 
. * Regress ReproSuccess on the LDpred PGS ("PGS"), on the PLINK PGS ("PGSraw"), and on the phenotypic variables:
. foreach var in  BMI EA3 GLU HGT SCZ2 TC AAM  {
  2.         qui replace PGS = PGSldp_`var'
  3.         qui reg ReproSuccess PGS i.byear pc*     i.hacohort  if sex == 1
  4.         est store `var'_ldp
  5.         qui replace PGS = PGSraw_`var'
  6.         qui reg ReproSuccess PGS        i.byear pc*     i.hacohort  if sex == 1
  7.         est store `var'_raw
  8.         qui replace Pheno = pheno_`var'
  9.         qui reg ReproSuccess Pheno i.byear                      i.hacohort    if sex == 1
 10.         est store `var'_pheno
 11. }

. * Estimate table for each trait separately:
. estimates table BMI_ldp EA3_ldp GLU_ldp HGT_ldp SCZ2_ldp TC_ldp  AAM_ldp, keep(PGS) b se t p stats(N)   

---------------------------------------------------------------------------------------------------------
    Variable |  BMI_ldp      EA3_ldp      GLU_ldp      HGT_ldp      SCZ2_ldp      TC_ldp      AAM_ldp    
-------------+-------------------------------------------------------------------------------------------
         PGS | -.01980834    .03059818   -.04350073   -.04632075    .00622725    .01980182   -.01024376  
             |  .02321088    .02279745    .02282529    .03141447    .02546179    .02322566    .02357084  
             |      -0.85         1.34        -1.91        -1.47         0.24         0.85        -0.43  
             |     0.3937       0.1800       0.0571       0.1408       0.8069       0.3942       0.6640  
-------------+-------------------------------------------------------------------------------------------
           N |        766          766          766          766          766          766          766  
---------------------------------------------------------------------------------------------------------
                                                                                         legend: b/se/t/p

. estimates table BMI_raw EA3_raw GLU_raw HGT_raw SCZ2_raw TC_raw  AAM_raw, keep(PGS) b se t p stats(N)

---------------------------------------------------------------------------------------------------------
    Variable |  BMI_raw      EA3_raw      GLU_raw      HGT_raw      SCZ2_raw      TC_raw      AAM_raw    
-------------+-------------------------------------------------------------------------------------------
         PGS |  -.0087231    .02567545   -.01975666   -.05807207    .00700542     .0067949   -.03475269  
             |   .0238964    .02335032    .02406765    .02885265     .0279583    .02334006    .02382279  
             |      -0.37         1.10        -0.82        -2.01         0.25         0.29        -1.46  
             |     0.7152       0.2719       0.4120       0.0445       0.8022       0.7710       0.1450  
-------------+-------------------------------------------------------------------------------------------
           N |        766          766          766          766          766          766          766  
---------------------------------------------------------------------------------------------------------
                                                                                         legend: b/se/t/p

. estimates table BMI_pheno EA3_pheno GLU_pheno  HGT_pheno SCZ2_pheno TC_pheno  AAM_pheno, keep(Pheno) b se t p sta
> ts(N)

---------------------------------------------------------------------------------------------------------
    Variable | BMI_pheno    EA3_pheno    GLU_pheno    HGT_pheno    SCZ2_pheno    TC_pheno    AAM_pheno   
-------------+-------------------------------------------------------------------------------------------
       Pheno |  .01480168   -.01309524    (omitted)    -.0001102    (omitted)   -.02431301    (omitted)  
             |  .00314746    .00605714                 .00253527                 .12187728               
             |       4.70        -2.16                     -0.04                     -0.20               
             |     0.0000       0.0308                    0.9653                    0.8424               
-------------+-------------------------------------------------------------------------------------------
           N |       1731         1736         1736         1735         1736           93         1736  
---------------------------------------------------------------------------------------------------------
                                                                                         legend: b/se/t/p

. 
. ************************************************************
. ************************************************************
. * REGRESSION ON THE PGS -- males only (=> sex == 0) 
. 
. * Regress ReproSuccess on the LDpred PGS ("PGS"), on the PLINK PGS ("PGSraw"), and on the phenotypic variables:
. foreach var in    BMI EA3 GLU HGT SCZ2 TC {
  2.         qui replace PGS = PGSldp_`var'
  3.         qui reg ReproSuccess PGS i.byear pc*  i.hacohort    if sex == 0
  4.         est store `var'_ldp
  5.         qui replace PGS = PGSraw_`var'
  6.         qui reg ReproSuccess PGS        i.byear pc*  i.hacohort if sex == 0
  7.         est store `var'_raw
  8.         qui replace Pheno = pheno_`var'
  9.         qui reg ReproSuccess Pheno i.byear                      i.hacohort    if sex == 0
 10.         est store `var'_pheno
 11. }

. * Estimate table for each trait separately:
. estimates table BMI_ldp EA3_ldp GLU_ldp HGT_ldp SCZ2_ldp TC_ldp, keep(PGS) b se t p stats(N)    

--------------------------------------------------------------------------------------------
    Variable |  BMI_ldp      EA3_ldp      GLU_ldp      HGT_ldp      SCZ2_ldp      TC_ldp    
-------------+------------------------------------------------------------------------------
         PGS |  .00200701    .02863228    .04449305    .05355812    .03698698   -.02648265  
             |  .02554069    .02559685    .02563987    .03355831    .02608101    .02536683  
             |       0.08         1.12         1.74         1.60         1.42        -1.04  
             |     0.9374       0.2638       0.0832       0.1110       0.1567       0.2969  
-------------+------------------------------------------------------------------------------
           N |        602          602          602          602          602          602  
--------------------------------------------------------------------------------------------
                                                                            legend: b/se/t/p

. estimates table BMI_raw EA3_raw GLU_raw HGT_raw SCZ2_raw TC_raw, keep(PGS) b se t p stats(N)

--------------------------------------------------------------------------------------------
    Variable |  BMI_raw      EA3_raw      GLU_raw      HGT_raw      SCZ2_raw      TC_raw    
-------------+------------------------------------------------------------------------------
         PGS |  .00962782    .01432432    .02421256    .06424919     .0617173   -.01218576  
             |  .02595475    .02593885    .02511448    .03237144    .02937109    .02577208  
             |       0.37         0.55         0.96         1.98         2.10        -0.47  
             |     0.7108       0.5810       0.3354       0.0477       0.0361       0.6365  
-------------+------------------------------------------------------------------------------
           N |        602          602          602          602          602          602  
--------------------------------------------------------------------------------------------
                                                                            legend: b/se/t/p

. estimates table BMI_pheno EA3_pheno GLU_pheno HGT_pheno SCZ2_pheno TC_pheno, keep(Pheno) b se t p stats(N)

--------------------------------------------------------------------------------------------
    Variable | BMI_pheno    EA3_pheno    GLU_pheno    HGT_pheno    SCZ2_pheno    TC_pheno   
-------------+------------------------------------------------------------------------------
       Pheno |  .00301082   -.00252968    (omitted)   -.00273589    (omitted)     -.067392  
             |  .00405509    .00514429                 .00241267                 .05865654  
             |       0.74        -0.49                     -1.13                     -1.15  
             |     0.4579       0.6230                    0.2570                    0.2511  
-------------+------------------------------------------------------------------------------
           N |       1562         1561         1562         1562         1562          590  
--------------------------------------------------------------------------------------------
                                                                            legend: b/se/t/p

. 
. 
. 
. cap log off
